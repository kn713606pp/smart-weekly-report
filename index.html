<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智慧週報 Pro (協作版)</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- 引入 Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .modal-backdrop { background-color: rgba(0,0,0,0.5); transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease, opacity 0.3s ease; }
        .comment-box::-webkit-scrollbar { width: 6px; }
        .comment-box::-webkit-scrollbar-track { background: #f1f1f1; }
        .comment-box::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
        .comment-box::-webkit-scrollbar-thumb:hover { background: #555; }
        .btn-loading .btn-text { visibility: hidden; opacity: 0; }
        .btn-loading .spinner { display: inline-block; }
        .auth-btn:disabled { background-color: #e5e7eb; border-color: #d1d5db; color: #9ca3af; cursor: not-allowed; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- 全局載入遮罩 -->
    <div id="global-loader" class="fixed inset-0 z-[100] bg-white/80 backdrop-blur-sm flex flex-col items-center justify-center hidden">
        <i class="fas fa-spinner fa-spin text-4xl text-indigo-600"></i>
        <p id="loader-text" class="mt-4 text-gray-700">處理中...</p>
    </div>

    <!-- 全局容器 -->
    <div id="app-wrapper" class="min-h-screen flex items-center justify-center p-4">

        <!-- 登入/註冊畫面 -->
        <div id="auth-container" class="w-full max-w-md fade-in">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h1 class="text-3xl font-bold text-center mb-2 text-gray-700">智慧週報 Pro</h1>
                <p class="text-center text-gray-500 mb-6">請登入或註冊以繼續</p>
                
                 <div id="status-panel" class="mb-4 p-3 rounded-lg text-center text-sm">
                     <p id="auth-error" class="font-semibold h-4"></p>
                </div>
                
                <button id="google-signin-btn" class="auth-btn w-full flex items-center justify-center gap-3 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition mb-4" disabled>
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google icon" class="w-5 h-5">
                    <span class="text-sm font-medium text-gray-700">以 Google 帳號登入</span>
                </button>

                <div class="relative flex py-3 items-center">
                    <div class="flex-grow border-t border-gray-300"></div>
                    <span class="flex-shrink mx-4 text-gray-400 text-xs">或以電子郵件</span>
                    <div class="flex-grow border-t border-gray-300"></div>
                </div>

                <div class="flex border-b mb-6">
                    <button id="show-login-btn" class="flex-1 py-2 font-semibold text-center text-indigo-600 border-b-2 border-indigo-600">登入</button>
                    <button id="show-register-btn" class="flex-1 py-2 font-semibold text-center text-gray-500">註冊</button>
                </div>

                <form id="login-form">
                    <div class="mb-4">
                        <label for="login-email" class="block text-sm font-medium text-gray-600 mb-1">電子郵件</label>
                        <input type="email" id="login-email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-6">
                        <label for="login-password" class="block text-sm font-medium text-gray-600 mb-1">密碼</label>
                        <input type="password" id="login-password" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <button id="login-submit-btn" type="submit" class="auth-btn w-full relative bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition duration-300" disabled>
                        <span class="btn-text">登入</span>
                        <span class="spinner hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"><i class="fas fa-spinner fa-spin"></i></span>
                    </button>
                </form>

                <form id="register-form" class="hidden">
                     <div class="mb-4">
                        <label for="register-name" class="block text-sm font-medium text-gray-600 mb-1">您的名稱</label>
                        <input type="text" id="register-name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label for="register-email" class="block text-sm font-medium text-gray-600 mb-1">電子郵件</label>
                        <input type="email" id="register-email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-6">
                        <label for="register-password" class="block text-sm font-medium text-gray-600 mb-1">密碼 (至少6位數)</label>
                        <input type="password" id="register-password" required minlength="6" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <button id="register-submit-btn" type="submit" class="auth-btn w-full relative bg-teal-500 text-white py-2 rounded-lg hover:bg-teal-600 transition duration-300" disabled>
                        <span class="btn-text">註冊新帳號</span>
                        <span class="spinner hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"><i class="fas fa-spinner fa-spin"></i></span>
                    </button>
                </form>
            </div>
        </div>

        <!-- 主要應用程式畫面 -->
        <div id="app-container" class="hidden w-full max-w-7xl mx-auto fade-in">
             <header class="flex flex-wrap justify-between items-center mb-6 pb-4 border-b gap-4">
                <h1 class="text-3xl font-bold text-gray-800">協作任務儀表板</h1>
                <div class="flex items-center">
                    <span id="user-display-name" class="text-gray-600 mr-4 hidden sm:inline"></span>
                    <button id="logout-btn" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition text-sm">登出</button>
                </div>
            </header>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
                        <h2 class="text-xl font-semibold">任務列表</h2>
                         <button id="add-new-task-btn" class="bg-indigo-600 text-white px-5 py-2 rounded-lg hover:bg-indigo-700 transition flex items-center gap-2">
                             <i class="fas fa-plus"></i> 新增任務
                         </button>
                    </div>
                     <div id="view-toggle-container" class="flex items-center gap-2 mb-4 border-b pb-4">
                        <span class="font-semibold text-gray-600">檢視：</span>
                        <button data-view="assigned" class="view-toggle-btn bg-indigo-600 text-white px-4 py-1 rounded-full text-sm">指派給我的</button>
                        <button data-view="created" class="view-toggle-btn bg-gray-200 text-gray-700 px-4 py-1 rounded-full text-sm">我建立的</button>
                    </div>
                    <div id="filter-container" class="flex flex-wrap gap-2 mb-4 border-b pb-4">
                        <button data-filter="all" class="filter-btn bg-indigo-500 text-white px-4 py-1 rounded-full text-sm">全部</button>
                        <button data-filter="todo" class="filter-btn bg-gray-200 text-gray-700 px-4 py-1 rounded-full text-sm">待處理</button>
                        <button data-filter="in_progress" class="filter-btn bg-gray-200 text-gray-700 px-4 py-1 rounded-full text-sm">進行中</button>
                        <button data-filter="done" class="filter-btn bg-gray-200 text-gray-700 px-4 py-1 rounded-full text-sm">已完成</button>
                    </div>
                    <div id="task-list" class="space-y-3 min-h-[300px]">
                        <div id="task-loader" class="text-center py-8">
                            <i class="fas fa-spinner fa-spin text-3xl text-gray-400"></i>
                            <p class="mt-2 text-gray-500">載入任務中...</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-semibold mb-4">週報生成</h2>
                     <button id="generate-report-btn" class="w-full bg-teal-500 text-white py-2 rounded-lg hover:bg-teal-600 transition mb-4 flex items-center justify-center gap-2">
                        <i class="fas fa-file-alt"></i> 生成本週我的已完成任務
                     </button>
                    <div id="report-output" class="hidden">
                        <textarea id="report-content" rows="10" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-sm" readonly></textarea>
                        <button id="copy-report-btn" class="w-full mt-2 bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-700 transition">複製內容</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="task-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden modal-backdrop"> <div class="bg-white w-full max-w-lg p-6 rounded-xl shadow-2xl modal-content"> <form id="modal-task-form"> <h2 id="modal-title" class="text-2xl font-bold mb-6">新增任務</h2> <input type="hidden" id="modal-task-id"> <div class="mb-4"> <label for="modal-task-title" class="block text-sm font-medium text-gray-600 mb-1">任務標題</label> <input type="text" id="modal-task-title" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"> </div> <div class="mb-4"> <label for="modal-task-assignee" class="block text-sm font-medium text-gray-600 mb-1">指派給</label> <select id="modal-task-assignee" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white"></select> </div> <div class="mb-4"> <label for="modal-task-desc" class="block text-sm font-medium text-gray-600 mb-1">詳細描述</label> <textarea id="modal-task-desc" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea> </div> <div class="mb-4"> <label for="modal-task-due-date" class="block text-sm font-medium text-gray-600 mb-1">截止日期</label> <input type="date" id="modal-task-due-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"> </div> <div class="flex justify-end gap-4 mt-6"> <button type="button" id="modal-cancel-btn" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition">取消</button> <button type="submit" id="modal-save-btn" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition">儲存</button> </div> </form> </div> </div>
    <div id="task-detail-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 hidden modal-backdrop"> <div class="bg-white w-full max-w-2xl max-h-[90vh] flex flex-col p-6 rounded-xl shadow-2xl modal-content"> <div class="flex justify-between items-center border-b pb-3 mb-4"> <h2 id="detail-modal-title" class="text-2xl font-bold">任務詳情</h2> <button id="detail-modal-close-btn" class="text-gray-500 hover:text-gray-800 text-2xl leading-none">&times;</button> </div> <div id="detail-modal-body" class="flex-grow overflow-y-auto pr-2"> </div> <div class="mt-4 pt-4 border-t"> <form id="add-comment-form" class="flex gap-2"> <input type="text" id="comment-input" placeholder="新增進度回報、溝通..." required class="flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"> <button type="submit" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition">送出</button> </form> </div> </div> </div>
    <div id="delete-confirm-modal" class="fixed inset-0 z-[70] flex items-center justify-center p-4 hidden modal-backdrop"> <div class="bg-white w-full max-w-sm p-6 rounded-xl shadow-2xl modal-content"> <h2 class="text-xl font-bold mb-4">確認刪除</h2> <p>您確定要刪除這個任務嗎？此操作無法復原。</p> <div class="flex justify-end gap-4 mt-6"> <button type="button" id="delete-cancel-btn" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition">取消</button> <button type="button" id="delete-confirm-btn" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition">確認刪-除</button> </div> </div> </div>

    <!-- Firebase SDK -->
    <script type="module" src="app.js"></script>
</body>
</html>

